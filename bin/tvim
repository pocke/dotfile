#!/usr/bin/env ruby

def main(argv)
  if ENV['VIM_TERMINAL']
    servername = ENV['VIM_SERVERNAME']
    raise "Please add the following to your vimrc: `call remote_startserver('tvim')`" unless servername
    start_tvim(argv, servername: servername)
  else
    exec('vim', *argv)
  end
end

def start_tvim(argv, servername:)
  require 'optparse'
  opt = OptionParser.new
  params = {}
  opt.on('--tab')
  args = opt.parse(argv, into: params)
  if params[:tab]
    args.unshift('--remote-tab') 
  else
    args.unshift('--remote') 
  end
  exec('vim', '--servername', servername, *args)
end

main(ARGV)
